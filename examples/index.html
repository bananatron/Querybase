<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
  <script src="querybase.js"></script>
  <meta charset="utf-8">
  <title>Querybase</title>
  <style>
    pre {
      white-space: pre;
      font-family: monospace;
    }
  </style>
</head>

<body>

  <button id="btnSeed">Seed</button>

  <ul>
    <li>Name:
      <input id="txtName">
    </li>
    <li>Age:
      <input id="txtAge">
    </li>
    <li>Location:
      <input id="txtLocation">
    </li>
    <li>Weight:
      <input id="txtWeight">
    </li>
    <li>
      <button id="btnFind">Find</button>
    </li>
  </ul>

  <pre id="preResult">
  
</pre>

  <script>
    const ref = new Firebase("https://querybase.firebaseio.com/");
		const peopleRef = ref.child("people");
		const queryRef = new Querybase(peopleRef, ['name', 'age', 'location', 'weight']);
		const btnSeed = document.getElementById('btnSeed');
    const txtName = document.getElementById('txtName');
    const txtAge = document.getElementById('txtAge');
    const txtLocation = document.getElementById('txtLocation');
    const txtWeight = document.getElementById('txtWeight');
    const btnFind = document.getElementById('btnFind');
    const preResult = document.getElementById('preResult');
    
		btnSeed.addEventListener('click', function(e) {
			peopleRef.remove();
			addPerson('David', 27, 'SF', 125);
			addPerson('Shannon', 28, 'SF', 115);
			addPerson('Coco', 1, 'SF', 12);
			addPerson('Cash', 3, 'SF', 32);
			addPerson('George', 27, 'DEN', 150);
			addPerson('Bob', '27', 'SF', 160);
			addPerson('Molly', 6, 'SF', 55);
			addPerson('Mambo', 4, 'DEN', 6);
		});
    
    btnFind.addEventListener('click', (e) => {
      const critieria = formatCriteria();
      queryRef.where(critieria).on('value', (snap) => {
        preResult.innerHTML = JSON.stringify(snap.val(), null, 4);
      });
    });
    
    function formatCriteria() {
      let criteria = getPersonCriteria();
      Object.keys(criteria).forEach((key) => {
        if (criteria[key] === "") {
          delete criteria[key];
        }
      });
      return criteria;
    }
    
    function getPersonCriteria() {
      return {
        name: txtName.value,
        age: txtAge.value,
        weight: txtWeight.value,
        location: txtLocation.value
      };
    }
		
		function listen(ref) {
			ref.on('value', function(snap) { 
				console.log(snap.val());
			});
		}
		
		function addPerson(name, age, location, weight) {
			queryRef.push({
				name: name,
				age: age,
				location: location,
				weight: weight
			});
		}
  </script>

</body>

</html>